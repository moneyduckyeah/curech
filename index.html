<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SecureChat ‚Äî E2EE</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Supabase client (fourni par CDN pour simplicit√©) -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
  <!-- env.js sera g√©n√©r√© lors du build (ne le commite pas) -->
  <script defer src="env.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="container">
      <h1>üîê SecureChat</h1>
      <small class="muted">Conversations E2EE ‚Äî cl√© c√¥t√© client ‚Ä¢ H√©berg√© sur Netlify ‚Ä¢ Stockage Supabase</small>
    </div>
  </header>

  <main class="container">
    <section class="card" id="hero">
      <div class="hero-left">
        <h2>Cr√©er une conversation s√©curis√©e</h2>
        <p>G√©n√®re une cl√© locale et partage un lien d'invitation. Les messages restent chiffr√©s sur Supabase.</p>
        <input id="title-input" placeholder="Titre de la conversation" />
        <div class="row">
          <button id="create-btn" class="btn">Cr√©er & g√©n√©rer lien</button>
          <button id="create-pass-btn" class="btn alt">Cr√©er avec mot de passe</button>
        </div>
        <div id="invite-area" class="invite hidden">
          <label>Lien d'invitation (partage s√©curis√©)</label>
          <textarea id="invite-link" rows="2" readonly></textarea>
          <div class="row">
            <button id="copy-invite" class="btn">Copier le lien</button>
            <button id="download-invite" class="btn alt">T√©l√©charger cl√©</button>
          </div>
        </div>
      </div>

      <div class="hero-right">
        <h3>Rejoindre</h3>
        <p>Si tu as re√ßu un lien, ouvre-le ou colle-le ici. Ensuite le chat se synchronise automatiquement.</p>
        <textarea id="paste-link" rows="2" placeholder="Coller lien d'invitation (optionnel)"></textarea>
        <div class="row">
          <input type="file" id="state-file" />
          <button id="load-btn" class="btn">Charger / Rejoindre</button>
        </div>
        <small class="muted">Tu peux aussi coller dans le presse-papier l'√©tat chiffr√© re√ßu.</small>
      </div>
    </section>

    <section class="card hidden" id="chat-card">
      <div class="chat-header">
        <div>
          <h2 id="chat-title">Conversation</h2>
          <small id="conv-id" class="muted"></small>
        </div>
        <div>
          <button id="export-state" class="btn alt">Exporter √©tat</button>
          <button id="copy-state" class="btn">Copier √©tat</button>
        </div>
      </div>

      <div id="messages" class="messages"></div>

      <div class="send-row">
        <input id="name-input" placeholder="Votre nom" />
        <textarea id="message-input" rows="2" placeholder="√âcrire un message..."></textarea>
        <div class="row">
          <button id="send-btn" class="btn">Envoyer</button>
          <button id="invite-again" class="btn alt">Reg√©n√©rer lien</button>
        </div>
      </div>

      <div class="notes">
        <small class="muted">Partagez la cl√© / lien de fa√ßon s√ªre (Signal, ProtonMail, USB...). Supabase stocke uniquement des blobs chiffr√©s.</small>
      </div>
    </section>
  </main>

  <footer class="container muted small">
    <p>Version pr√™te √† d√©ployer ‚Ä¢ Sujets sensibles : voir README pour meilleures pratiques</p>
  </footer>
</body>
</html>
